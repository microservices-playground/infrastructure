---

dependencies:

  - role: jdauphant.nginx
    become: yes
    nginx_sites:
      default:
        - listen 80
        - server_name _
        - root "/srv/code/web"
        - error_log /srv/log/nginx-error.log;
        - access_log /srv/log/nginx-access.log;
        - location / {
            try_files $uri /app.php$is_args$args;
          }
        - location ~ ^/(app_dev|config)\.php(/|$) {
            fastcgi_pass unix:/var/run/php5-fpm.sock;
            fastcgi_split_path_info ^(.+\.php)(/.*)$;
            include fastcgi_params;
            fastcgi_param SCRIPT_FILENAME $realpath_root$fastcgi_script_name;
            fastcgi_param DOCUMENT_ROOT $realpath_root;
          }
        - location ~ ^/app\.php(/|$) {
            fastcgi_pass unix:/var/run/php5-fpm.sock;
            fastcgi_split_path_info ^(.+\.php)(/.*)$;
            include fastcgi_params;
            fastcgi_param SCRIPT_FILENAME $realpath_root$fastcgi_script_name;
            fastcgi_param DOCUMENT_ROOT $realpath_root;
            internal;
          }
        - location ~ \.php$ {
            return 404;
          }

  - role: chusiang.php7
    become: yes
    php_timezone: Europe/London
